define ("local_workflow/WFEnrolMailPreview",["jquery","core/notification","jqueryui","local_workflow/jquery.loadingModal"],function(a,b){function c(c){a("#wf_dialog_preview_mails").dialog({autoOpen:!1,width:700,height:"auto",maxHeight:470,title:"Pr\xE9visualisation de l'inscription mail",draggable:"false",modal:!0,resizable:!1,closeOnEscape:!1,closeText:"Fermer",buttons:[{text:"Valider",id:"btValidateMails",click:function click(){if(a(".mform").length){a(".mform")[0].submit()}}},{text:"Annuler",id:"btCancel",click:function click(){a(this).dialog("close")}}]});a("#id_submitbutton").click(function(){var d=[],e=[],f=[],g=[],h=[],i=[],j=[];a("div[id^=fitem_id_][id$=_groups_user_enrol]").map(function(b,c){var d=[];a(c).find("select").find(":selected").map(function(b,c){d.push(a(c).text())});h.push(d.join())});a("div[id^=fitem_id_][id$=_userfile]").map(function(b,c){var f=/fitem_id_(.*)_userfile/g.exec(a(c).attr("id")),g=f[1];a(c).find(".filepicker-filename").find("a").map(function(c,f){d.push(a(f).attr("href"));e.push(g);i.push(h[b])})});a("div[id^=fitem_id_][id$=_email_user_enrol]").map(function(b,c){var d=/fitem_id_(.*)_email_user_enrol/g.exec(a(c).attr("id")),e=d[1];a(c).find("textarea").filter(function(b,c){return""!=a(c).val()}).map(function(c,d){f.push(a(d).val());g.push(e);j.push(h[b])})});if(0<d.length||f&&0<f.length){a("body").loadingModal({position:"auto",text:"Validation des emails en cours...",color:"#fff",opacity:"0.7",backgroundColor:"rgb(0,0,0)",animation:"circle"});a.post(c,{urls:d,files_role:e,manual_emails:f,manual_emails_role:g,csv_groups_lists:i,manual_groups_lists:j},function(c){if("false"==c.error){b.alert("Erreur","Erreur de communication avec le serveur.","Retour")}else{a("#wf_dialog_preview_mails").html(c);a("#wf_dialog_preview_mails").show();a("#wf_dialog_preview_mails").dialog("open")}a("body").loadingModal("destroy")},"html")}else{if(a(".mform").length){a(".mform")[0].submit()}}})}return{init:function init(a){c(a)}}});
//# sourceMappingURL=WFEnrolMailPreview.min.js.map
